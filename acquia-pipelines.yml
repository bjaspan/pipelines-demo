version: 1.0.0

services:
  - mysql

events:
  build:
    steps:
      - ssh-setup:
          script:
            - echo 'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAybzZHfVpre0lzTGbWt/JtOi57uQ6DQJQUQ1xgWhPkPdwQu/O+ZKgJ/lx8ruQluihSCOwhc8nl42hYd0rq30LVI5Ku4K0w2Q8GDxee9FFfIDIvwpQCnOp2JxLOc7Ow/cKmuHlyLgrp+/4nRxkzDIONu8vBadxPZPHxZe8Xh5xx+NCiap0B+KAY5bYvpD7nwqmnxkHSevSW20ZYtGJJI1Mv8GF4YsDZupdvkM1EfDxf14sg0MbL73Z/G4yj3/u06Z6MsVjhEO6krMbog9QELnBRpdfixWrFCHTxW3ExGfUDtj/rtsaYAkMoPLfEMUJSpACmayue/DFeg/l8r5cUKCM4Q== bjaspan@barry-jaspans-macbook-pro-3.local' >> $HOME/.ssh/authorized_keys
      - install:
          type: script
          script:
            - 'composer --no-interaction --quiet install'
            - 'sudo /etc/init.d/mysql start'
            - 'mysql -u root -proot -e "CREATE DATABASE drupal"'
            - 'cd docroot'
            - '/usr/bin/env PHP_OPTIONS="-d sendmail_path=`which true`" ../vendor/bin/drush site-install -y --db-url=mysql://root:root@127.0.0.1:3306/drupal'
            - 'php -S 127.0.0.1:8081 &'
            - 'sleep 2'
            - 'cd ..'
            - ./vendor/bin/behat
